<div class="container">
    <h1>My Reservations</h1>

    <section>
        <h2>Current Reservations</h2>
        <div *ngIf="currentReservations.length === 0"><p>You have no current reservations.</p></div>
        <table *ngIf="currentReservations.length > 0">
            <thead>
                <tr>
                    <th>Cottage</th>
                    <th>Period</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let res of currentReservations">
                    <td><a [routerLink]="['/cottage', res.cottageId._id]">{{ res.cottageId.name }}</a> ({{ res.cottageId.location }})</td>
                    <td>{{ res.startDate | date: 'dd.MM.yyyy' }} - {{ res.endDate | date: 'dd.MM.yyyy' }}</td>
                    <td>{{ res.status }}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-danger" *ngIf="res.status !== 'canceled' && canCancel(res)" (click)="onCancel(res._id)">Cancel</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </section>

    <section>
        <h2>Reservations Archive</h2>
        <div *ngIf="reservationsArchive.length === 0"><p>You have no previous reservations.</p></div>
        <table *ngIf="reservationsArchive.length > 0">
            <thead>
                <tr>
                    <th>Cottage</th>
                    <th>Period</th>
                    <th>Status</th>
                    <th>Review</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let res of reservationsArchive">
                    <td><a [routerLink]="['/cottage', res.cottageId._id]">{{ res.cottageId.name }}</a> ({{ res.cottageId.location }})</td>
                    <td>{{ res.startDate | date: 'dd.MM.yyyy' }} - {{ res.endDate | date: 'dd.MM.yyyy' }}</td>
                    <td>{{ res.status }}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-primary" *ngIf="res.status === 'approved' && isPastDate(res.endDate) && !res.isReviewed" (click)="openFormForReview(res)">Post a Review</button>
                        </div>
                        <span *ngIf="res.isReviewed">Reviewed</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </section>
</div>

<app-modal [title]="'Leave a Review'">
    <form [formGroup]="formForReview" (ngSubmit)="onSendReview()">
        <div class="form-group">
            <label>Rating (1-5)</label>
            <select formControlName="rating">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>
        <div class="form-group">
            <label>Comment</label>
            <textarea formControlName="comment" rows="4"></textarea>
        </div>
        <div class="btn-group">
            <button class="btn btn-special" type="button" (click)="reservationForReview = null">Back</button>
            <button class="btn btn-primary" type="submit" [disabled]="formForReview.invalid">Send</button>
        </div>
    </form>
</app-modal>
